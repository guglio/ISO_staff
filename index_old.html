<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Minimal Form</title>
</head>

<body>
  <div id="contact-form">
    <form id="contact">
      <fieldset>
        <label for="nome">Nome</label>    <input type="text" name="nome" placeholder="Name" title="Enter your name" class="required">
        <label for="cognome">Cognome</label>    <input type="text" name="cognome" placeholder="Cognome" title="Enter your name" class="required">
        <label for="cantiere">Cantiere</label>
        <select name="cantiere">
          <option value="Buzzi">Buzzi</option>
          <option value="Michelin">Michelin</option>
          <option value="Torino">Torino</option>
          <option value="Uffici">Uffici</option>
          <option value="Trino">Trino</option>
          <option value="Boves">Boves</option>
          <option value="Officina">Officina</option>
          <option value="Pulizie">Pulizie</option>
        </select>
        <label for="cf">Codice Fiscale</label>
        <input type="text" name="cf" placeholder="Codice Fiscale">
        <label for="assunzione">Data di assunzione</label>
        <input type="date" name="assunzione" placeholder="Data di assunzione">
        <label for="qualifica">Qualifica</label>
        <input type="text" name="qualifica" placeholder="Qualifica">
        <label for="liv">Livello</label>
        <input type="text" name="liv" placeholder="Livello">
        <label for="cod_dip">Codice Dipendente</label>
        <input type="number" name="cod_dip" placeholder="Codice Dipendente">

        <input type="submit" name="submit" class="button" id="submit" value="submit">
      </fieldset>
    </form>
  </div>
  <form id="getData">
    <fieldset>
      <label for="cantieri">Get names</label>
      <select name="cantieri" id="cantieri">
        <option value="all">All</option>
        <option value="buzzi">Buzzi</option>
        <option value="michelin">Michelin</option>
        <option value="torino">Torino</option>
        <option value="uffici">Uffici</option>
        <option value="trino">Trino</option>
        <option value="boves">Boves</option>
        <option value="officina">Officina</option>
        <option value="pulizie">Pulizie</option>
      </select>

    <input type="submit" name="submit" class="button" id="submit" value="submit">
    </fieldset>
  </form>
  <div id="result"></div>
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script>
  (function ($) {
    $.fn.serializeObject = function(){
    var formData = {};
    var formArray = this.serializeArray();

    for(var i = 0, n = formArray.length; i < n; ++i)
      formData[formArray[i].name] = formArray[i].value;

    return formData;
  };
})(jQuery);
// Attach a submit handler to the form
$( "#contact" ).submit(function( event ) {

  // Stop form from submitting normally
  event.preventDefault();
  // var formData = $("#contact").serializeObject();

  var formData = JSON.stringify($('#contact').serializeObject());

  console.log(formData);

  // Get some values from elements on the page:
  //$.post("http://127.0.0.1:5984/personale_ciam/",formData,"json");
  $.ajax({
   type: "POST",
   url: "http://127.0.0.1:5984/personale_ciam/",
   contentType: "application/json",
   data: formData,
   //dataType: "jsonp",
   success: function(data) {
     console.log(data);
   }
  });
});





$( "#getData" ).submit(function( event ) {

  // Stop form from submitting normally
  event.preventDefault();
  var selectData = $( "#cantieri" ).val();
  var urlDB = "http://127.0.0.1:5984/personale_ciam/";
  var jsonUrl = urlDB+"_design/cantieri/_view/"+selectData;

  $.getJSON(jsonUrl , function( data ) {
  var items = [];
  var newData = data.rows;
  console.log(data);
  $.each( newData, function(key, val) {
    row = val.value;
    items.push( "<li><a href=\""+urlDB+"_design/ISO/_show/hello/"+val.id+"\" target=\"_blank\">Dipendente: " + row.cognome + " "+ row.nome+"</a> CF: "+row.cf+"</li>" );
  });
  $("#result").html("<ul>"+items.join( "" )+"</ul>");
});

});
</script>
</body>
</html>
